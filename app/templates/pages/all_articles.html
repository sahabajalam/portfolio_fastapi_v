{% extends "base.html" %}

{% block title %}All Articles - {{ app_name }}{% endblock %}

{% block content %}
<!-- Hero Section with Page Header - Same as Note on AI page -->
<section class="bg-white relative overflow-hidden min-h-[30vh] pt-20 flex items-center">
    <div class="absolute inset-0" style="background: linear-gradient(135deg, #0f172a 0%, #064e3b 100%);"></div>
    <div class="container mx-auto px-4 relative z-10">
        <div class="text-center">
            <h1 class="font-serif text-3xl md:text-4xl lg:text-5xl font-bold text-white mb-4">
                All <span
                    class="bg-gradient-to-r from-green-400 to-blue-500 bg-clip-text text-transparent">Articles</span>
            </h1>
            <p class="text-gray-300 text-lg md:text-xl max-w-3xl mx-auto">
                Browse through all my insights on machine learning, AI research, and technology
            </p>
        </div>
    </div>
</section>

<!-- All Posts Section -->
<section class="py-16 bg-gray-50">
    <div class="container mx-auto px-6">
        <!-- Section Title -->
        <div class="flex items-center gap-3 mb-8">
            <div class="w-1 h-8 bg-gradient-to-b from-primary-600 to-secondary-600 rounded-full"></div>
            <h2 class="text-2xl font-bold text-gray-900">All Posts</h2>
        </div>

        <!-- Filter Tags -->
        <div class="mb-12">
            <h3 class="text-lg font-semibold text-gray-700 mb-4">Filter by Category:</h3>
            <div class="flex flex-wrap gap-3">
                <!-- All filter button -->
                <button class="filter-tag active" data-category="all">
                    <span
                        class="bg-gray-800 text-white px-4 py-2 rounded-full text-sm font-semibold transition-all duration-300 hover:bg-gray-700">
                        All Posts
                    </span>
                </button>

                <!-- Dynamic category filters -->
                {% set categories = articles | map(attribute='category') | list | unique %}
                {% for category in categories %}
                <button class="filter-tag" data-category="{{ category | lower | replace(' ', '-') }}">
                    {% if category == "Tutorial" %}
                    <span
                        class="bg-green-100 text-green-800 px-4 py-2 rounded-full text-sm font-semibold transition-all duration-300 hover:bg-green-200">
                        {{ category }}
                    </span>
                    {% elif category == "Analysis" %}
                    <span
                        class="bg-purple-100 text-purple-800 px-4 py-2 rounded-full text-sm font-semibold transition-all duration-300 hover:bg-purple-200">
                        {{ category }}
                    </span>
                    {% elif category == "Best Practices" %}
                    <span
                        class="bg-yellow-100 text-yellow-800 px-4 py-2 rounded-full text-sm font-semibold transition-all duration-300 hover:bg-yellow-200">
                        {{ category }}
                    </span>
                    {% elif category == "Technical Deep Dive" %}
                    <span
                        class="bg-indigo-100 text-indigo-800 px-4 py-2 rounded-full text-sm font-semibold transition-all duration-300 hover:bg-indigo-200">
                        Deep Dive
                    </span>
                    {% else %}
                    <span
                        class="bg-blue-100 text-blue-800 px-4 py-2 rounded-full text-sm font-semibold transition-all duration-300 hover:bg-blue-200">
                        {{ category }}
                    </span>
                    {% endif %}
                </button>
                {% endfor %}
            </div>
        </div>

        <!-- Articles Grid -->
        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8" id="articles-grid">
            {% for article in articles %}
            <article
                class="article-card bg-white rounded-2xl shadow-lg overflow-hidden transition-all duration-300 hover:transform hover:translateY(-8px) hover:shadow-2xl"
                data-category="{{ article.category | lower | replace(' ', '-') }}">
                {% if article.image_url %}
                <img src="{{ article.image_url }}" alt="{{ article.title }}" class="w-full h-48 object-cover">
                {% else %}
                <div class="w-full h-48 bg-gradient-to-br from-purple-500 to-blue-600 flex items-center justify-center">
                    <i class="fas fa-brain text-white text-3xl opacity-50"></i>
                </div>
                {% endif %}

                <div class="p-6">
                    <div class="flex items-center gap-2 mb-3">
                        {% if article.category == "Tutorial" %}
                        <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-xs font-semibold">{{
                            article.category }}</span>
                        {% elif article.category == "Analysis" %}
                        <span class="bg-purple-100 text-purple-800 px-3 py-1 rounded-full text-xs font-semibold">{{
                            article.category }}</span>
                        {% elif article.category == "Best Practices" %}
                        <span class="bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full text-xs font-semibold">{{
                            article.category }}</span>
                        {% elif article.category == "Technical Deep Dive" %}
                        <span class="bg-indigo-100 text-indigo-800 px-3 py-1 rounded-full text-xs font-semibold">Deep
                            Dive</span>
                        {% else %}
                        <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-xs font-semibold">{{
                            article.category }}</span>
                        {% endif %}
                        <span class="text-gray-400 text-xs">{{ article.published_date.strftime('%b %d, %Y') }}</span>
                    </div>

                    <h3 class="font-serif text-xl font-bold text-gray-900 mb-3 leading-tight">
                        {% if article.external_url %}
                        <a href="{{ article.external_url }}" target="_blank"
                            class="hover:text-primary-600 transition-colors duration-300 hover:underline">
                            {{ article.title }}
                        </a>
                        {% else %}
                        {{ article.title }}
                        {% endif %}
                    </h3>

                    <p class="text-gray-600 text-sm mb-4 leading-relaxed">
                        {{ article.excerpt | truncate(120) }}
                    </p>

                    <div class="flex items-center justify-between">
                        <span class="text-xs text-gray-500">{{ article.read_time }} min read</span>
                        <div class="flex gap-2">
                            {% if article.external_url %}
                            <a href="{{ article.external_url }}" target="_blank"
                                class="text-gray-400 hover:text-primary-500 transition-colors">
                                <i class="fas fa-external-link-alt"></i>
                            </a>
                            {% endif %}
                            <button class="text-gray-400 hover:text-red-500 transition-colors">
                                <i class="fas fa-heart"></i>
                            </button>
                            <button class="text-gray-400 hover:text-blue-500 transition-colors">
                                <i class="fas fa-bookmark"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </article>
            {% endfor %}
        </div>

        <!-- Pagination -->
        <div class="flex justify-center items-center mt-16 gap-2" id="pagination">
            <!-- Previous button -->
            <button
                class="pagination-btn prev-btn px-4 py-2 rounded-lg border border-gray-300 text-gray-600 hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                disabled>
                <i class="fas fa-chevron-left mr-2"></i>Previous
            </button>

            <!-- Page numbers (will be populated by JavaScript) -->
            <div class="flex gap-1" id="page-numbers">
                <!-- Page numbers will be inserted here by JavaScript -->
            </div>

            <!-- Next button -->
            <button
                class="pagination-btn next-btn px-4 py-2 rounded-lg border border-gray-300 text-gray-600 hover:bg-gray-50 transition-colors">
                Next<i class="fas fa-chevron-right ml-2"></i>
            </button>
        </div>
    </div>
</section>

<!-- JavaScript for filtering and pagination -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const articlesGrid = document.getElementById('articles-grid');
        const filterTags = document.querySelectorAll('.filter-tag');
        const paginationContainer = document.getElementById('pagination');
        const pageNumbersContainer = document.getElementById('page-numbers');
        const prevBtn = document.querySelector('.prev-btn');
        const nextBtn = document.querySelector('.next-btn');

        let currentPage = 1;
        const articlesPerPage = 6;
        let filteredArticles = [];
        let allArticles = [];

        // Initialize
        function init() {
            allArticles = Array.from(document.querySelectorAll('.article-card'));
            filteredArticles = [...allArticles];
            showPage(1);
            updatePagination();
        }

        // Filter functionality
        filterTags.forEach(tag => {
            tag.addEventListener('click', function () {
                // Remove active class from all tags
                filterTags.forEach(t => t.classList.remove('active'));
                // Add active class to clicked tag
                this.classList.add('active');

                const category = this.dataset.category;

                if (category === 'all') {
                    filteredArticles = [...allArticles];
                } else {
                    filteredArticles = allArticles.filter(article =>
                        article.dataset.category === category
                    );
                }

                currentPage = 1;
                showPage(1);
                updatePagination();
            });
        });

        // Show specific page
        function showPage(page) {
            const startIndex = (page - 1) * articlesPerPage;
            const endIndex = startIndex + articlesPerPage;

            // Hide all articles
            allArticles.forEach(article => {
                article.style.display = 'none';
            });

            // Show articles for current page
            filteredArticles.slice(startIndex, endIndex).forEach(article => {
                article.style.display = 'block';
            });

            currentPage = page;
            updateNavigationButtons();
        }

        // Update pagination
        function updatePagination() {
            const totalPages = Math.ceil(filteredArticles.length / articlesPerPage);

            // Clear existing page numbers
            pageNumbersContainer.innerHTML = '';

            // Create page number buttons
            for (let i = 1; i <= totalPages; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.className = `page-number px-3 py-2 rounded-lg text-sm font-medium transition-colors ${i === currentPage
                        ? 'bg-primary-600 text-white'
                        : 'text-gray-600 hover:bg-gray-100'
                    }`;
                pageBtn.textContent = i;
                pageBtn.addEventListener('click', () => showPage(i));
                pageNumbersContainer.appendChild(pageBtn);
            }

            updateNavigationButtons();
        }

        // Update navigation buttons
        function updateNavigationButtons() {
            const totalPages = Math.ceil(filteredArticles.length / articlesPerPage);

            prevBtn.disabled = currentPage === 1;
            nextBtn.disabled = currentPage === totalPages;

            // Update active page number styling
            document.querySelectorAll('.page-number').forEach((btn, index) => {
                if (index + 1 === currentPage) {
                    btn.className = 'page-number px-3 py-2 rounded-lg text-sm font-medium transition-colors bg-primary-600 text-white';
                } else {
                    btn.className = 'page-number px-3 py-2 rounded-lg text-sm font-medium transition-colors text-gray-600 hover:bg-gray-100';
                }
            });
        }

        // Navigation button handlers
        prevBtn.addEventListener('click', () => {
            if (currentPage > 1) {
                showPage(currentPage - 1);
            }
        });

        nextBtn.addEventListener('click', () => {
            const totalPages = Math.ceil(filteredArticles.length / articlesPerPage);
            if (currentPage < totalPages) {
                showPage(currentPage + 1);
            }
        });

        // Initialize the page
        init();
    });
</script>

<!-- CSS for active filter styling -->
<style>
    .filter-tag.active span {
        transform: scale(1.05);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .filter-tag {
        cursor: pointer;
    }

    .pagination-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    .page-number {
        min-width: 40px;
        cursor: pointer;
    }
</style>

{% endblock %}